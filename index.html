<!DOCTYPE html>
<html>
<head>
	<title>Editor</title>
  <link href="content-tools.min.css" rel="stylesheet" />

</head>
<body>







                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header" data-background-color="purple">
                                    <h4 class="title">Create Blog</h4>
                                  
                                </div>
                                <div class="card-content table-responsive">
 

      <form action="someurl" method="post" id="blog_form" enctype="multipart/form-data">

        
        <div class="row">
            <div class="col-md-12">

                <div class="form-group label-floating">
                    <label class="control-label">Title</label>
                    <input type="text" name="name" class="form-control" id="title" value="{{@$blog->name}}" minlength="15" maxlength="35" required>

                </div>
            </div>
        </div>


        <div  class="row">
          <div class="col-md-12" >
                <div class="form-group label-floating">
                    <label class="control-label">Header Image</label>
                    <br>
                    <br>
                   

              <div class="fileinput fileinput-new text-center" data-provides="fileinput">
                <div class="fileinput-new thumbnail">

                <div id="defaultimage" style="
                  background-position: center;
                  background-image: url('');
     
                  background-repeat: no-repeat;
                  background-size: cover; height: 250px; width: 80%;">
                  <!-- <img src="{{ asset('public/img/sample/image_placeholder.jpg') }}" id="defaultimage" alt="..." style="max-height: 250px; max-width: 80%;">
                  <img  id="uploadedimage" alt="..." style="max-height: 250px; display: none; max-width: 80%;"> -->
                </div>

                <div id="uploadedimage" style="background-position: center;
                  background-repeat: no-repeat;
                  background-size: cover; height: 250px; width: 80%; display: none;">
                  <!-- <img src="{{ asset('public/img/sample/image_placeholder.jpg') }}" id="defaultimage" alt="..." style="max-height: 250px; max-width: 80%;">
                  <img  id="uploadedimage" alt="..." style="max-height: 250px; display: none; max-width: 80%;"> -->
                </div>


                </div>
                  <span class="btn btn-rose btn-round btn-file">
                    <span class="fileinput-new">Select image</span>
                    <span class="fileinput-exists">Change</span>

                  </span>

     
                
              </div>


                </div>
          </div>
        </div>



        <div  class="row">
          <div class="col-md-12">
                <div class="form-group label-floating">
                    <label class="control-label">Content</label>
                    <br>
                    <br>
                  <div data-editable data-name="main-content"  id="content">

                      <h2 contenteditable="" class="ce-element ce-element--type-text ce-element--focused text-center">YOUR TEXT HERE</h2>
                  
                  </div>
                  <input type="hidden" name="message" id="message">
                </div>
          </div>
        </div>


        <div class="row">

        </div>



        <button type="submit" class="btn btn-primary" id="submit">Save Blog</button>


      </form>






                                </div>
                            </div>
                        </div>

 






<script src="jquery-3.2.1.min.js" type="text/javascript"></script>



<script src="content-tools.min.js"></script>
<script src="editor.js"></script>

<script type="text/javascript">





     function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    // $('#uploadedimage')
                        // .attr('src', e.target.result);

                     $('#uploadedimage').css("background-image", 'url("' + e.target.result + '")' );
                    $('#defaultimage').hide();
                    $('#uploadedimage').show();
                    $('#removeImage').show();
                };

                reader.readAsDataURL(input.files[0]);
            }
        }




function saveform(){


    var payload ='';
    payload = ($('#content').html());
    message = payload.replace(/<(?:.|\n)*?>/gm, '');

    // var title = ($('#title').val());
    var id = ($('#blogid').val());
    // console.log(title);
    // console.log(payload);
    // console.log(message);


// console.log(title.length);
// console.log(id);
// console.log(message.length);

if (message.length>10) {

          $.ajax({
          type: "POST",
          url: "{{url('/ContentToolsStore')}}",
          data: { id: id, message:  payload},
          dataType: 'JSON',
          success: function(message) {
                    console.log(message);  
                // $('#blogid').val(message[0]);
                new ContentTools.FlashUI('ok');
            },
          error: function(message){
                    console.log(message);  
                new ContentTools.FlashUI('no');

          }
          });

}else{
  alert('Content need to be more than 200 char.');
  new ContentTools.FlashUI('no');
  
}
}





$(document).ready(function(){


  $('#removeImage').click(function(){
    $('#defaultimage').show();
      $('#uploadedimage').hide();
       $('#removeImage').hide();

  });



$('#blog_form').submit(function(event){


  if (editor._state == 'editing') {
    alert('Close the editor');
    return false;
  }else{
  var message = $('#content').html();
  $('#message').val(message); 
  message = message.replace(/<(?:.|\n)*?>/gm, '');
  if (message.length>500) {
    saveform(editor);    
  }else{
    alert('Content need to be more than 200 char.');
    return false;
  }



  }


});


// editor = ContentTools.EditorApp.get();
// editor.start();
// editor.ignition().state('editing');
// console.log(editor);

});


window.addEventListener('load', function() {
    var editor;
});




ContentTools.StylePalette.add([
    new ContentTools.Style('Author', 'author', ['p'])
]);




// Initialize our editor
var editor = ContentTools.EditorApp.get();
editor.init('*[data-editable]', 'data-name');
editor.start();
editor.ignition().state('editing');
console.log(editor);


// Listen for saved events
editor.addEventListener('saved', function (ev) {
    var name, payload, regions, xhr;

    // Check that something changed
    regions = ev.detail().regions;
    if (Object.keys(regions).length == 0) {
        return;
    }

    // Set the editor as busy while we save our changes
    this.busy(true);


    // Collect the contents of each region into a FormData instance
    // payload = new FormData();
    // for (name in regions) {
    //     if (regions.hasOwnProperty(name)) {
    //         payload.append(name, regions[name]);
    //     }
    // }

    // Send the update content to the server to be saved
    // function onStateChange(ev) {
    //     // Check if the request is finished
    //     if (ev.target.readyState == 4) {
    //         editor.busy(false);
    //         console.log(ev);
    //         if (ev.target.status == '200') {
    //             // Save was successful, notify the user with a flash
    //             new ContentTools.FlashUI('ok');
    //         } else {
    //             // Save failed, notify the user with a flash
    //             new ContentTools.FlashUI('no');
    //         }
    //     }
    // };

    // xhr = new XMLHttpRequest();
    // // xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    // xhr.addEventListener('readystatechange', onStateChange);
    // xhr.open('POST', "{{url('/blogStore')}}");
    // // xhr.setRequestHeader('X-XSRF-TOKEN', "{{ csrf_token() }}");
    // // xhr.open('POST', '/save-my-page');
    // xhr.send(hello);


  saveform(editor);


  this.busy(false);
});





</script>


</body>
</html>